<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>波本本的分享空间</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            transition: background-image 0.5s ease;
        }
        
        /* 头部样式 */
        header {
            background-color: #4a6fa5;
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        
        .logo-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            margin-right: 15px;
            cursor: pointer;
        }
        
        h1 {
            font-size: 2.2rem;
            letter-spacing: 2px;
        }
        
        /* 导航标签样式 */
        nav {
            display: flex;
            justify-content: center;
            background-color: #3a5a8a;
            padding: 0 20px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.8);
            position: relative;
        }
        
        .tab:hover {
            background-color: #2a4a7a;
            color: white;
        }
        
        .tab.active {
            background-color: #1a3a6a;
            color: white;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: #ffcc00;
        }
        
        /* 主内容区样式 */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .tab-content {
            display: none;
            min-height: 500px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 数据展示区域 */
        .data-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .data-item {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .data-item:hover {
            transform: translateY(-5px);
        }
        
        .empty-message {
            text-align: center;
            padding: 60px 20px;
            color: #888;
            font-size: 1.2rem;
            grid-column: 1 / -1;
        }
        
        /* 图片相关样式 */
        .image-container {
            width: 100%;
            height: 200px;
            overflow: hidden;
            border-radius: 5px;
            margin-bottom: 15px;
            cursor: pointer;
        }
        
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .image-container img:hover {
            transform: scale(1.05);
        }
        
        .item-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .item-detail {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        /* 按钮样式 */
        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #4a6fa5;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3a5a8a;
        }
        
        .btn-edit {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-edit:hover {
            background-color: #e67e22;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }
        
        .upload-btn {
            display: block;
            margin: 30px auto 0;
            padding: 12px 30px;
            font-size: 1.1rem;
        }
        
        /* 弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal {
            background-color: white;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8rem;
            cursor: pointer;
            color: #999;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            border-color: #4a6fa5;
            outline: none;
        }
        
        .file-input {
            padding: 10px 0;
        }
        
        .form-hint {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
        }
        
        .password-prompt {
            text-align: center;
            padding: 20px 0;
        }
        
        .password-prompt input {
            margin-top: 10px;
            width: 200px;
        }
        
        .password-error {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        
        /* 图片放大查看样式 */
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1100;
        }
        
        .image-viewer img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        
        .image-viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2.5rem;
            cursor: pointer;
        }
        
        /* 设置页面样式 */
        .settings-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
        }
        
        .setting-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }
        
        .setting-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
        }
        
        .current-logo, .current-bg {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            margin: 15px auto;
            display: block;
            cursor: pointer;
        }
        
        .current-bg {
            width: 200px;
            height: 120px;
        }
        
        .setting-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            nav {
                flex-wrap: wrap;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 1rem;
            }
            
            .data-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .settings-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .logo-img {
                width: 50px;
                height: 50px;
            }
            
            .data-container {
                grid-template-columns: 1fr;
            }
            
            .tab-content {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- 头部区域 -->
    <header>
        <div class="logo-container">
            <img id="site-logo" class="logo-img" src="" alt="波本本空间Logo">
            <h1>波本本的分享空间</h1>
        </div>
    </header>

    <!-- 导航标签 -->
    <nav>
        <div class="tab active" data-tab="images">图片分享</div>
        <div class="tab" data-tab="diary">流水账</div>
        <div class="tab" data-tab="send">发片</div>
        <div class="tab" data-tab="register">登记</div>
        <div class="tab" data-tab="settings">设置</div>
        <div class="tab" data-tab="contact">戳戳我</div>
    </nav>

    <!-- 主内容区域 -->
    <div class="container">
        <!-- 图片分享标签页 -->
        <div id="images" class="tab-content active">
            <h2>图片分享</h2>
            <div class="data-container" id="images-container">
                <!-- 图片数据会通过JS动态插入 -->
            </div>
            <button class="btn btn-primary upload-btn" id="upload-image-btn">上传图片</button>
        </div>

        <!-- 流水账标签页 -->
        <div id="diary" class="tab-content">
            <h2>流水账</h2>
            <div class="data-container" id="diary-container">
                <!-- 流水账数据会通过JS动态插入 -->
            </div>
            <button class="btn btn-primary upload-btn" id="upload-diary-btn">添加流水账</button>
        </div>

        <!-- 发片标签页 -->
        <div id="send" class="tab-content">
            <h2>发片</h2>
            <div class="data-container" id="send-container">
                <!-- 发片数据会通过JS动态插入 -->
            </div>
            <button class="btn btn-primary upload-btn" id="upload-send-btn">发片上传</button>
        </div>

        <!-- 登记标签页 -->
        <div id="register" class="tab-content">
            <h2>登记</h2>
            <div class="data-container" id="register-container">
                <!-- 登记数据会通过JS动态插入 -->
            </div>
            <button class="btn btn-primary upload-btn" id="upload-register-btn">登记上传</button>
        </div>

        <!-- 设置标签页 -->
        <div id="settings" class="tab-content">
            <h2>设置</h2>
            <div class="settings-container">
                <div class="setting-section">
                    <h3>LOGO设置</h3>
                    <img id="current-logo-img" class="current-logo" src="" alt="当前LOGO">
                    <div class="setting-actions">
                        <button class="btn btn-primary" id="upload-logo-btn">上传LOGO</button>
                        <button class="btn btn-edit" id="edit-logo-btn">修改</button>
                        <button class="btn btn-delete" id="delete-logo-btn">删除</button>
                    </div>
                </div>
                
                <div class="setting-section">
                    <h3>背景设置</h3>
                    <img id="current-bg-img" class="current-bg" src="" alt="当前背景">
                    <div class="setting-actions">
                        <button class="btn btn-primary" id="upload-bg-btn">上传背景</button>
                        <button class="btn btn-edit" id="edit-bg-btn">修改</button>
                        <button class="btn btn-delete" id="delete-bg-btn">删除</button>
                    </div>
                </div>
                
                <div class="setting-section">
                    <h3>戳戳我设置</h3>
                    <p>点击上方"戳戳我"标签页进行设置</p>
                </div>
            </div>
        </div>

        <!-- 戳戳我标签页 -->
        <div id="contact" class="tab-content">
            <h2>戳戳我</h2>
            <div class="data-container" id="contact-container">
                <!-- 戳戳我图片数据会通过JS动态插入 -->
            </div>
            <button class="btn btn-primary upload-btn" id="upload-contact-btn">上传图片</button>
        </div>
    </div>

    <!-- 弹窗上传表单 -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-close" id="modal-close">&times;</div>
            <h2 id="modal-title">上传表单</h2>
            <div id="password-prompt" class="password-prompt">
                <p>请输入管理密码</p>
                <input type="password" id="password-input" class="form-control" placeholder="请输入密码">
                <div id="password-error" class="password-error">密码错误，请重试</div>
                <button class="btn btn-primary" id="password-submit" style="margin-top: 15px;">提交</button>
            </div>
            <form id="upload-form" style="display: none;">
                <!-- 表单内容会根据不同的上传类型动态生成 -->
            </form>
        </div>
    </div>

    <!-- 图片查看器 -->
    <div id="image-viewer" class="image-viewer">
        <div class="image-viewer-close">&times;</div>
        <img id="viewed-image" src="" alt="查看的图片">
    </div>

    <script>
        // 应用状态和常量
        const APP_STATE = {
            currentTab: 'images',
            defaultPassword: '740302',
            modalType: null,
            editingId: null
        };

        // 数据存储结构
        const DATA_STORAGE = {
            images: [],      // 图片分享数据
            diary: [],       // 流水账数据
            send: [],        // 发片数据
            register: [],    // 登记数据
            contact: [],     // 戳戳我数据
            settings: {      // 设置数据
                logo: '',
                background: ''
            }
        };

        // DOM加载完成后初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 从localStorage加载数据
            loadData();
            
            // 恢复之前的活动标签页
            const savedTab = localStorage.getItem('currentTab');
            if (savedTab) {
                switchTab(savedTab);
            }
            
            // 初始化事件监听器
            initEventListeners();
            
            // 初始化页面内容
            initPageContent();
        });

        // 加载数据
        function loadData() {
            Object.keys(DATA_STORAGE).forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    if (key === 'settings') {
                        DATA_STORAGE[key] = JSON.parse(data);
                    } else {
                        DATA_STORAGE[key] = JSON.parse(data) || [];
                    }
                }
            });
        }

        // 保存数据
        function saveData(key) {
            localStorage.setItem(key, JSON.stringify(DATA_STORAGE[key]));
        }

        // 切换标签页
        function switchTab(tabId) {
            // 更新活动标签
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // 更新活动内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId) {
                    content.classList.add('active');
                }
            });
            
            // 保存当前标签页
            APP_STATE.currentTab = tabId;
            localStorage.setItem('currentTab', tabId);
        }

        // 初始化事件监听器
        function initEventListeners() {
            // 标签页切换
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });
            
            // 上传按钮
            document.getElementById('upload-image-btn').addEventListener('click', () => showUploadModal('image'));
            document.getElementById('upload-diary-btn').addEventListener('click', () => showUploadModal('diary'));
            document.getElementById('upload-send-btn').addEventListener('click', () => showUploadModal('send'));
            document.getElementById('upload-register-btn').addEventListener('click', () => showUploadModal('register'));
            document.getElementById('upload-contact-btn').addEventListener('click', () => showUploadModal('contact'));
            
            // 设置页按钮
            document.getElementById('upload-logo-btn').addEventListener('click', () => showUploadModal('logo'));
            document.getElementById('edit-logo-btn').addEventListener('click', () => editLogo());
            document.getElementById('delete-logo-btn').addEventListener('click', () => deleteLogo());
            document.getElementById('upload-bg-btn').addEventListener('click', () => showUploadModal('background'));
            document.getElementById('edit-bg-btn').addEventListener('click', () => editBackground());
            document.getElementById('delete-bg-btn').addEventListener('click', () => deleteBackground());
            
            // 弹窗相关
            document.getElementById('modal-close').addEventListener('click', closeModal);
            document.getElementById('password-submit').addEventListener('click', checkPassword);
            document.querySelector('.modal-overlay').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            // 图片查看器
            document.querySelector('.image-viewer-close').addEventListener('click', closeImageViewer);
            document.getElementById('image-viewer').addEventListener('click', function(e) {
                if (e.target === this) closeImageViewer();
            });
        }

        // 初始化页面内容
        function initPageContent() {
            // 显示图片分享数据
            renderImages();
            
            // 显示流水账数据
            renderDiary();
            
            // 显示发片数据
            renderSend();
            
            // 显示登记数据
            renderRegister();
            
            // 显示戳戳我数据
            renderContact();
            
            // 更新LOGO和背景
            updateLogo();
            updateBackground();
        }

        // 显示上传弹窗
        function showUploadModal(type, editId = null) {
            APP_STATE.modalType = type;
            APP_STATE.editingId = editId;
            
            // 显示密码输入界面
            document.getElementById('password-prompt').style.display = 'block';
            document.getElementById('upload-form').style.display = 'none';
            document.getElementById('password-input').value = '';
            document.getElementById('password-error').style.display = 'none';
            
            // 显示弹窗
            document.getElementById('modal-overlay').style.display = 'flex';
        }

        // 检查密码
        function checkPassword() {
            const password = document.getElementById('password-input').value;
            
            if (password === APP_STATE.defaultPassword) {
                // 密码正确，显示表单
                document.getElementById('password-prompt').style.display = 'none';
                document.getElementById('upload-form').style.display = 'block';
                
                // 根据类型生成表单
                generateForm(APP_STATE.modalType, APP_STATE.editingId);
            } else {
                // 密码错误
                document.getElementById('password-error').style.display = 'block';
            }
        }

        // 生成表单
        function generateForm(type, editId = null) {
            const form = document.getElementById('upload-form');
            form.innerHTML = '';
            
            let formHTML = '';
            let title = '';
            let isEditMode = editId !== null;
            
            switch(type) {
                case 'image':
                    title = isEditMode ? '修改图片' : '上传图片';
                    formHTML = generateImageForm(editId);
                    break;
                case 'diary':
                    title = isEditMode ? '修改流水账' : '添加流水账';
                    formHTML = generateDiaryForm(editId);
                    break;
                case 'send':
                    title = isEditMode ? '修改发片' : '发片上传';
                    formHTML = generateSendForm(editId);
                    break;
                case 'register':
                    title = isEditMode ? '修改登记' : '登记上传';
                    formHTML = generateRegisterForm(editId);
                    break;
                case 'contact':
                    title = isEditMode ? '修改戳戳我图片' : '上传戳戳我图片';
                    formHTML = generateContactForm(editId);
                    break;
                case 'logo':
                    title = isEditMode ? '修改LOGO' : '上传LOGO';
                    formHTML = generateLogoForm();
                    break;
                case 'background':
                    title = isEditMode ? '修改背景' : '上传背景';
                    formHTML = generateBackgroundForm();
                    break;
            }
            
            document.getElementById('modal-title').textContent = title;
            form.innerHTML = formHTML;
            
            // 添加表单提交事件
            form.onsubmit = function(e) {
                e.preventDefault();
                handleFormSubmit(type, editId);
            };
            
            // 自动生成编号（发片）
            if (type === 'send' && !isEditMode) {
                generateSendNumber();
            }
        }

        // 生成图片上传表单
        function generateImageForm(editId) {
            let formData = { title: '', location: '', note: '' };
            
            if (editId !== null) {
                const item = DATA_STORAGE.images.find(img => img.id === editId);
                if (item) formData = item;
            }
            
            return `
                <div class="form-group">
                    <label for="image-title">标题 *</label>
                    <input type="text" id="image-title" class="form-control" value="${formData.title}" required>
                </div>
                <div class="form-group">
                    <label for="image-location">上传地点（省、市、区、街道）</label>
                    <input type="text" id="image-location" class="form-control" value="${formData.location}" placeholder="例如：浙江省、杭州市、西湖区、文三路">
                </div>
                <div class="form-group">
                    <label for="image-note">备注（限30字）</label>
                    <textarea id="image-note" class="form-control" rows="3" maxlength="30" placeholder="请输入备注信息（最多30个字）">${formData.note}</textarea>
                    <div class="form-hint">已输入 <span id="note-count">0</span>/30 字</div>
                </div>
                <div class="form-group">
                    <label for="image-upload">${editId ? '更换图片' : '上传图片（支持JPG、JPEG、PNG，最多5张）'}</label>
                    <input type="file" id="image-upload" class="form-control file-input" accept=".jpg,.jpeg,.png" ${editId ? '' : 'multiple'} ${editId ? '' : 'required'}>
                    <div class="form-hint">${editId ? '如果不选择新图片，将保留原图片' : '可多选，最多5张图片'}</div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">${editId ? '保存修改' : '上传图片'}</button>
                </div>
            `;
        }

        // 生成流水账表单
        function generateDiaryForm(editId) {
            let formData = { content: '' };
            
            if (editId !== null) {
                const item = DATA_STORAGE.diary.find(d => d.id === editId);
                if (item) formData = item;
            }
            
            return `
                <div class="form-group">
                    <label for="diary-content">流水账内容（限30字）*</label>
                    <textarea id="diary-content" class="form-control" rows="4" maxlength="30" placeholder="请输入流水账内容（最多30个字）" required>${formData.content}</textarea>
                    <div class="form-hint">已输入 <span id="diary-count">0</span>/30 字</div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">${editId ? '保存修改' : '添加流水账'}</button>
                </div>
            `;
        }

        // 生成发片表单
        function generateSendForm(editId) {
            let formData = { number: '', location: '' };
            
            if (editId !== null) {
                const item = DATA_STORAGE.send.find(s => s.id === editId);
                if (item) formData = item;
            }
            
            return `
                <div class="form-group">
                    <label for="send-number">编号</label>
                    <input type="text" id="send-number" class="form-control" value="${formData.number}" ${editId ? 'readonly' : ''}>
                    <div class="form-hint">${editId ? '编号不可修改' : '将自动生成当天日期+001-099的编号'}</div>
                </div>
                <div class="form-group">
                    <label for="send-location">上传地址（省、市、区、街道）</label>
                    <input type="text" id="send-location" class="form-control" value="${formData.location}" placeholder="例如：浙江省、杭州市、西湖区、文三路">
                </div>
                <div class="form-group">
                    <label for="send-upload">${editId ? '更换图片' : '上传图片（支持JPG、JPEG、PNG）'}</label>
                    <input type="file" id="send-upload" class="form-control file-input" accept=".jpg,.jpeg,.png" ${editId ? '' : 'required'}>
                    <div class="form-hint">${editId ? '如果不选择新图片，将保留原图片' : '请选择一张图片'}</div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">${editId ? '保存修改' : '发片上传'}</button>
                </div>
            `;
        }

        // 生成登记表单
        function generateRegisterForm(editId) {
            let formData = { number: '', sendDate: '', location: '' };
            
            if (editId !== null) {
                const item = DATA_STORAGE.register.find(r => r.id === editId);
                if (item) formData = item;
            }
            
            return `
                <div class="form-group">
                    <label for="register-number">编号 *</label>
                    <input type="text" id="register-number" class="form-control" value="${formData.number}" required>
                </div>
                <div class="form-group">
                    <label for="register-send-date">发片日期</label>
                    <input type="date" id="register-send-date" class="form-control" value="${formData.sendDate || ''}">
                </div>
                <div class="form-group">
                    <label for="register-location">上传地址（省、市、区、街道）</label>
                    <input type="text" id="register-location" class="form-control" value="${formData.location}" placeholder="例如：浙江省、杭州市、西湖区、文三路">
                </div>
                <div class="form-group">
                    <label for="register-upload">${editId ? '更换图片' : '上传图片（支持JPG、JPEG、PNG）'}</label>
                    <input type="file" id="register-upload" class="form-control file-input" accept=".jpg,.jpeg,.png" ${editId ? '' : 'required'}>
                    <div class="form-hint">${editId ? '如果不选择新图片，将保留原图片' : '请选择一张图片'}</div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">${editId ? '保存修改' : '登记上传'}</button>
                </div>
            `;
        }

        // 生成戳戳我表单
        function generateContactForm(editId) {
            return `
                <div class="form-group">
                    <label for="contact-upload">${editId ? '更换图片' : '上传图片（支持JPG、JPEG、PNG）'}</label>
                    <input type="file" id="contact-upload" class="form-control file-input" accept=".jpg,.jpeg,.png" ${editId ? '' : 'required'}>
                    <div class="form-hint">${editId ? '如果不选择新图片，将保留原图片' : '请选择一张图片'}</div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">${editId ? '保存修改' : '上传图片'}</button>
                </div>
            `;
        }

        // 生成LOGO表单
        function generateLogoForm() {
            return `
                <div class="form-group">
                    <label for="logo-upload">上传LOGO图片（支持JPG、JPEG、PNG）</label>
                    <input type="file" id="logo-upload" class="form-control file-input" accept=".jpg,.jpeg,.png" required>
                    <div class="form-hint">建议尺寸：75px × 75px</div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">上传LOGO</button>
                </div>
            `;
        }

        // 生成背景表单
        function generateBackgroundForm() {
            return `
                <div class="form-group">
                    <label for="bg-upload">上传背景图片（支持JPG、JPEG、PNG）</label>
                    <input type="file" id="bg-upload" class="form-control file-input" accept=".jpg,.jpeg,.png" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">上传背景</button>
                </div>
            `;
        }

        // 生成发片编号
        function generateSendNumber() {
            const today = new Date();
            const dateStr = today.getFullYear().toString() + 
                           (today.getMonth() + 1).toString().padStart(2, '0') + 
                           today.getDate().toString().padStart(2, '0');
            
            // 查找当天已有的编号
            const todayItems = DATA_STORAGE.send.filter(item => {
                return item.number && item.number.startsWith(dateStr);
            });
            
            // 生成新编号
            let newNumber = '';
            if (todayItems.length === 0) {
                newNumber = dateStr + '001';
            } else {
                // 获取最大编号
                const maxNum = Math.max(...todayItems.map(item => {
                    const numPart = item.number.substring(8);
                    return parseInt(numPart) || 0;
                }));
                
                const nextNum = (maxNum + 1).toString().padStart(3, '0');
                if (parseInt(nextNum) <= 99) {
                    newNumber = dateStr + nextNum;
                } else {
                    newNumber = dateStr + '099';
                }
            }
            
            const numberInput = document.getElementById('send-number');
            if (numberInput) {
                numberInput.value = newNumber;
            }
        }

        // 处理表单提交
        function handleFormSubmit(type, editId) {
            switch(type) {
                case 'image':
                    saveImage(editId);
                    break;
                case 'diary':
                    saveDiary(editId);
                    break;
                case 'send':
                    saveSend(editId);
                    break;
                case 'register':
                    saveRegister(editId);
                    break;
                case 'contact':
                    saveContact(editId);
                    break;
                case 'logo':
                    saveLogo();
                    break;
                case 'background':
                    saveBackground();
                    break;
            }
            
            closeModal();
        }

        // 保存图片
        function saveImage(editId) {
            const title = document.getElementById('image-title').value;
            const location = document.getElementById('image-location').value;
            const note = document.getElementById('image-note').value;
            const fileInput = document.getElementById('image-upload');
            
            // 获取当前时间
            const now = new Date();
            const dateStr = now.getFullYear() + '年' + 
                          (now.getMonth() + 1) + '月' + 
                          now.getDate() + '日 ' + 
                          now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0');
            
            if (editId) {
                // 编辑现有图片
                const index = DATA_STORAGE.images.findIndex(img => img.id === editId);
                if (index !== -1) {
                    DATA_STORAGE.images[index].title = title;
                    DATA_STORAGE.images[index].location = location;
                    DATA_STORAGE.images[index].note = note;
                    DATA_STORAGE.images[index].date = dateStr;
                    
                    // 如果有新图片，更新图片
                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            DATA_STORAGE.images[index].image = e.target.result;
                            saveData('images');
                            renderImages();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        saveData('images');
                        renderImages();
                    }
                }
            } else {
                // 新增图片
                const newImages = [];
                
                // 处理多个图片
                for (let i = 0; i < Math.min(fileInput.files.length, 5); i++) {
                    const file = fileInput.files[i];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const newItem = {
                            id: Date.now() + i,
                            title: title,
                            location: location,
                            note: note,
                            date: dateStr,
                            image: e.target.result
                        };
                        
                        newImages.push(newItem);
                        
                        // 当所有图片都读取完成后
                        if (newImages.length === Math.min(fileInput.files.length, 5)) {
                            DATA_STORAGE.images.push(...newImages);
                            saveData('images');
                            renderImages();
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            }
        }

        // 保存流水账
        function saveDiary(editId) {
            const content = document.getElementById('diary-content').value;
            
            // 获取当前时间
            const now = new Date();
            const dateStr = now.getFullYear() + '年' + 
                          (now.getMonth() + 1) + '月' + 
                          now.getDate() + '日 ' + 
                          now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0');
            
            if (editId) {
                // 编辑现有流水账
                const index = DATA_STORAGE.diary.findIndex(d => d.id === editId);
                if (index !== -1) {
                    DATA_STORAGE.diary[index].content = content;
                    DATA_STORAGE.diary[index].date = dateStr;
                    saveData('diary');
                    renderDiary();
                }
            } else {
                // 新增流水账
                const newItem = {
                    id: Date.now(),
                    content: content,
                    date: dateStr
                };
                
                DATA_STORAGE.diary.unshift(newItem);
                saveData('diary');
                renderDiary();
            }
        }

        // 保存发片
        function saveSend(editId) {
            const number = document.getElementById('send-number').value;
            const location = document.getElementById('send-location').value;
            const fileInput = document.getElementById('send-upload');
            
            // 获取当前时间
            const now = new Date();
            const dateStr = now.getFullYear() + '年' + 
                          (now.getMonth() + 1) + '月' + 
                          now.getDate() + '日 ' + 
                          now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0');
            
            if (editId) {
                // 编辑现有发片
                const index = DATA_STORAGE.send.findIndex(s => s.id === editId);
                if (index !== -1) {
                    DATA_STORAGE.send[index].location = location;
                    DATA_STORAGE.send[index].date = dateStr;
                    
                    // 如果有新图片，更新图片
                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            DATA_STORAGE.send[index].image = e.target.result;
                            saveData('send');
                            renderSend();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        saveData('send');
                        renderSend();
                    }
                }
            } else {
                // 新增发片
                if (fileInput.files.length === 0) {
                    alert('请选择一张图片');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const newItem = {
                        id: Date.now(),
                        number: number,
                        location: location,
                        date: dateStr,
                        image: e.target.result
                    };
                    
                    DATA_STORAGE.send.unshift(newItem);
                    saveData('send');
                    renderSend();
                };
                
                reader.readAsDataURL(file);
            }
        }

        // 保存登记
        function saveRegister(editId) {
            const number = document.getElementById('register-number').value;
            const sendDate = document.getElementById('register-send-date').value;
            const location = document.getElementById('register-location').value;
            const fileInput = document.getElementById('register-upload');
            
            // 获取当前时间
            const now = new Date();
            const dateStr = now.getFullYear() + '年' + 
                          (now.getMonth() + 1) + '月' + 
                          now.getDate() + '日 ' + 
                          now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0');
            
            if (editId) {
                // 编辑现有登记
                const index = DATA_STORAGE.register.findIndex(r => r.id === editId);
                if (index !== -1) {
                    DATA_STORAGE.register[index].number = number;
                    DATA_STORAGE.register[index].sendDate = sendDate;
                    DATA_STORAGE.register[index].location = location;
                    DATA_STORAGE.register[index].date = dateStr;
                    
                    // 如果有新图片，更新图片
                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            DATA_STORAGE.register[index].image = e.target.result;
                            saveData('register');
                            renderRegister();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        saveData('register');
                        renderRegister();
                    }
                }
            } else {
                // 新增登记
                if (fileInput.files.length === 0) {
                    alert('请选择一张图片');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const newItem = {
                        id: Date.now(),
                        number: number,
                        sendDate: sendDate,
                        location: location,
                        date: dateStr,
                        image: e.target.result
                    };
                    
                    DATA_STORAGE.register.unshift(newItem);
                    saveData('register');
                    renderRegister();
                };
                
                reader.readAsDataURL(file);
            }
        }

        // 保存戳戳我
        function saveContact(editId) {
            const fileInput = document.getElementById('contact-upload');
            
            // 获取当前时间
            const now = new Date();
            const dateStr = now.getFullYear() + '年' + 
                          (now.getMonth() + 1) + '月' + 
                          now.getDate() + '日 ' + 
                          now.getHours().toString().padStart(2, '0') + ':' + 
                          now.getMinutes().toString().padStart(2, '0');
            
            if (editId) {
                // 编辑现有戳戳我图片
                const index = DATA_STORAGE.contact.findIndex(c => c.id === editId);
                if (index !== -1) {
                    DATA_STORAGE.contact[index].date = dateStr;
                    
                    // 如果有新图片，更新图片
                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            DATA_STORAGE.contact[index].image = e.target.result;
                            saveData('contact');
                            renderContact();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        saveData('contact');
                        renderContact();
                    }
                }
            } else {
                // 新增戳戳我图片
                if (fileInput.files.length === 0) {
                    alert('请选择一张图片');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const newItem = {
                        id: Date.now(),
                        date: dateStr,
                        image: e.target.result
                    };
                    
                    DATA_STORAGE.contact.unshift(newItem);
                    saveData('contact');
                    renderContact();
                };
                
                reader.readAsDataURL(file);
            }
        }

        // 保存LOGO
        function saveLogo() {
            const fileInput = document.getElementById('logo-upload');
            
            if (fileInput.files.length === 0) {
                alert('请选择一张图片');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                DATA_STORAGE.settings.logo = e.target.result;
                saveData('settings');
                updateLogo();
                alert('LOGO已更新');
            };
            
            reader.readAsDataURL(file);
        }

        // 保存背景
        function saveBackground() {
            const fileInput = document.getElementById('bg-upload');
            
            if (fileInput.files.length === 0) {
                alert('请选择一张图片');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                DATA_STORAGE.settings.background = e.target.result;
                saveData('settings');
                updateBackground();
                alert('背景已更新');
            };
            
            reader.readAsDataURL(file);
        }

        // 编辑LOGO
        function editLogo() {
            showUploadModal('logo');
        }

        // 删除LOGO
        function deleteLogo() {
            if (confirm('确定要删除LOGO吗？')) {
                DATA_STORAGE.settings.logo = '';
                saveData('settings');
                updateLogo();
            }
        }

        // 编辑背景
        function editBackground() {
            showUploadModal('background');
        }

        // 删除背景
        function deleteBackground() {
            if (confirm('确定要删除背景图片吗？')) {
                DATA_STORAGE.settings.background = '';
                saveData('settings');
                updateBackground();
            }
        }

        // 更新LOGO显示
        function updateLogo() {
            const logoImg = document.getElementById('site-logo');
            const currentLogoImg = document.getElementById('current-logo-img');
            
            if (DATA_STORAGE.settings.logo) {
                logoImg.src = DATA_STORAGE.settings.logo;
                currentLogoImg.src = DATA_STORAGE.settings.logo;
                logoImg.style.display = 'block';
                currentLogoImg.style.display = 'block';
            } else {
                logoImg.style.display = 'none';
                currentLogoImg.style.display = 'none';
            }
        }

        // 更新背景显示
        function updateBackground() {
            if (DATA_STORAGE.settings.background) {
                document.body.style.backgroundImage = `url(${DATA_STORAGE.settings.background})`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
                
                const currentBgImg = document.getElementById('current-bg-img');
                currentBgImg.src = DATA_STORAGE.settings.background;
                currentBgImg.style.display = 'block';
            } else {
                document.body.style.backgroundImage = 'none';
                document.body.style.backgroundColor = '#f5f7fa';
                
                const currentBgImg = document.getElementById('current-bg-img');
                currentBgImg.style.display = 'none';
            }
        }

        // 关闭弹窗
        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
            APP_STATE.modalType = null;
            APP_STATE.editingId = null;
        }

        // 打开图片查看器
        function openImageViewer(imageSrc) {
            document.getElementById('viewed-image').src = imageSrc;
            document.getElementById('image-viewer').style.display = 'flex';
        }

        // 关闭图片查看器
        function closeImageViewer() {
            document.getElementById('image-viewer').style.display = 'none';
        }

        // 渲染图片分享数据
        function renderImages() {
            const container = document.getElementById('images-container');
            
            if (DATA_STORAGE.images.length === 0) {
                container.innerHTML = '<div class="empty-message">等待图片上传</div>';
                return;
            }
            
            container.innerHTML = '';
            
            DATA_STORAGE.images.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'data-item';
                itemElement.innerHTML = `
                    <div class="image-container">
                        <img src="${item.image}" alt="${item.title}" onclick="openImageViewer('${item.image}')">
                    </div>
                    <div class="item-title">${item.title || '无标题'}</div>
                    <div class="item-detail">上传日期：${item.date}</div>
                    <div class="item-detail">上传地点：${item.location || '未填写'}</div>
                    <div class="item-detail">备注：${item.note || '无备注'}</div>
                    <div class="action-buttons">
                        <button class="btn btn-edit" onclick="editImage('${item.id}')">修改</button>
                        <button class="btn btn-delete" onclick="deleteImage('${item.id}')">删除</button>
                    </div>
                `;
                
                container.appendChild(itemElement);
            });
        }

        // 渲染流水账数据
        function renderDiary() {
            const container = document.getElementById('diary-container');
            
            if (DATA_STORAGE.diary.length === 0) {
                container.innerHTML = '<div class="empty-message">等待流水账上传</div>';
                return;
            }
            
            container.innerHTML = '';
            
            DATA_STORAGE.diary.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'data-item';
                itemElement.innerHTML = `
                    <div class="item-title">${item.date}</div>
                    <div class="item-detail" style="margin-top: 10px;">${item.content}</div>
                    <div class="action-buttons">
                        <button class="btn btn-edit" onclick="editDiary('${item.id}')">修改</button>
                        <button class="btn btn-delete" onclick="deleteDiary('${item.id}')">删除</button>
                    </div>
                `;
                
                container.appendChild(itemElement);
            });
        }

        // 渲染发片数据
        function renderSend() {
            const container = document.getElementById('send-container');
            
            if (DATA_STORAGE.send.length === 0) {
                container.innerHTML = '<div class="empty-message">等待发片上传</div>';
                return;
            }
            
            container.innerHTML = '';
            
            DATA_STORAGE.send.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'data-item';
                itemElement.innerHTML = `
                    <div class="image-container">
                        <img src="${item.image}" alt="发片图片" onclick="openImageViewer('${item.image}')">
                    </div>
                    <div class="item-title">编号：${item.number}</div>
                    <div class="item-detail">上传日期：${item.date}</div>
                    <div class="item-detail">上传地址：${item.location || '未填写'}</div>
                    <div class="action-buttons">
                        <button class="btn btn-edit" onclick="editSend('${item.id}')">修改</button>
                        <button class="btn btn-delete" onclick="deleteSend('${item.id}')">删除</button>
                    </div>
                `;
                
                container.appendChild(itemElement);
            });
        }

        // 渲染登记数据
        function renderRegister() {
            const container = document.getElementById('register-container');
            
            if (DATA_STORAGE.register.length === 0) {
                container.innerHTML = '<div class="empty-message">等待登记上传</div>';
                return;
            }
            
            container.innerHTML = '';
            
            DATA_STORAGE.register.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'data-item';
                itemElement.innerHTML = `
                    <div class="image-container">
                        <img src="${item.image}" alt="登记图片" onclick="openImageViewer('${item.image}')">
                    </div>
                    <div class="item-title">编号：${item.number}</div>
                    <div class="item-detail">发片日期：${item.sendDate || '未填写'}</div>
                    <div class="item-detail">登记日期：${item.date}</div>
                    <div class="item-detail">上传地址：${item.location || '未填写'}</div>
                    <div class="action-buttons">
                        <button class="btn btn-edit" onclick="editRegister('${item.id}')">修改</button>
                        <button class="btn btn-delete" onclick="deleteRegister('${item.id}')">删除</button>
                    </div>
                `;
                
                container.appendChild(itemElement);
            });
        }

        // 渲染戳戳我数据
        function renderContact() {
            const container = document.getElementById('contact-container');
            
            if (DATA_STORAGE.contact.length === 0) {
                container.innerHTML = '<div class="empty-message">等待戳戳我图片上传</div>';
                return;
            }
            
            container.innerHTML = '';
            
            DATA_STORAGE.contact.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'data-item';
                itemElement.innerHTML = `
                    <div class="image-container">
                        <img src="${item.image}" alt="戳戳我图片" onclick="openImageViewer('${item.image}')">
                    </div>
                    <div class="item-detail">上传日期：${item.date}</div>
                    <div class="action-buttons">
                        <button class="btn btn-edit" onclick="editContact('${item.id}')">修改</button>
                        <button class="btn btn-delete" onclick="deleteContact('${item.id}')">删除</button>
                    </div>
                `;
                
                container.appendChild(itemElement);
            });
        }

        // 编辑图片
        function editImage(id) {
            showUploadModal('image', id);
        }

        // 删除图片
        function deleteImage(id) {
            if (confirm('确定要删除这张图片吗？')) {
                DATA_STORAGE.images = DATA_STORAGE.images.filter(img => img.id !== id);
                saveData('images');
                renderImages();
            }
        }

        // 编辑流水账
        function editDiary(id) {
            showUploadModal('diary', id);
        }

        // 删除流水账
        function deleteDiary(id) {
            if (confirm('确定要删除这条流水账吗？')) {
                DATA_STORAGE.diary = DATA_STORAGE.diary.filter(d => d.id !== id);
                saveData('diary');
                renderDiary();
            }
        }

        // 编辑发片
        function editSend(id) {
            showUploadModal('send', id);
        }

        // 删除发片
        function deleteSend(id) {
            if (confirm('确定要删除这个发片吗？')) {
                DATA_STORAGE.send = DATA_STORAGE.send.filter(s => s.id !== id);
                saveData('send');
                renderSend();
            }
        }

        // 编辑登记
        function editRegister(id) {
            showUploadModal('register', id);
        }

        // 删除登记
        function deleteRegister(id) {
            if (confirm('确定要删除这个登记吗？')) {
                DATA_STORAGE.register = DATA_STORAGE.register.filter(r => r.id !== id);
                saveData('register');
                renderRegister();
            }
        }

        // 编辑戳戳我
        function editContact(id) {
            showUploadModal('contact', id);
        }

        // 删除戳戳我
        function deleteContact(id) {
            if (confirm('确定要删除这个戳戳我图片吗？')) {
                DATA_STORAGE.contact = DATA_STORAGE.contact.filter(c => c.id !== id);
                saveData('contact');
                renderContact();
            }
        }

        // 暴露函数到全局作用域
        window.openImageViewer = openImageViewer;
        window.editImage = editImage;
        window.deleteImage = deleteImage;
        window.editDiary = editDiary;
        window.deleteDiary = deleteDiary;
        window.editSend = editSend;
        window.deleteSend = deleteSend;
        window.editRegister = editRegister;
        window.deleteRegister = deleteRegister;
        window.editContact = editContact;
        window.deleteContact = deleteContact;
    </script>
</body>
</html>
